# ms1_email_ingestor Architecture Document

## Table of Contents

- [ms1_email_ingestor Architecture Document](#table-of-contents)
  - [1. Introduction](./1-introduction.md)
    - [1.1. Starter Template or Existing Project](./1-introduction.md#11-starter-template-or-existing-project)
    - [1.2. Change Log](./1-introduction.md#12-change-log)
  - [2. High Level Architecture](./2-high-level-architecture.md)
    - [2.1. Technical Summary](./2-high-level-architecture.md#21-technical-summary)
    - [2.2. High Level Overview](./2-high-level-architecture.md#22-high-level-overview)
    - [2.3. High Level Project Diagram](./2-high-level-architecture.md#23-high-level-project-diagram)
    - [2.4. Architectural and Design Patterns](./2-high-level-architecture.md#24-architectural-and-design-patterns)
  - [3. Tech Stack](./3-tech-stack.md)
    - [3.1. Cloud Infrastructure](./3-tech-stack.md#31-cloud-infrastructure)
    - [3.2. Technology Stack Table](./3-tech-stack.md#32-technology-stack-table)
  - [4. Data Models](./4-data-models.md)
    - [4.1. EmailMessage](./4-data-models.md#41-emailmessage)
    - [4.2. SessionState](./4-data-models.md#42-sessionstate)
    - [4.3. WebhookSubscription](./4-data-models.md#43-webhooksubscription)
  - [5. Components](./5-components.md)
    - [5.1. Component List](./5-components.md#51-component-list)
    - [5.1.1. Polling Service](./5-components.md#511-polling-service)
    - [5.1.2. Webhook Service](./5-components.md#512-webhook-service)
    - [5.1.3. Redis Inbound Queue](./5-components.md#513-redis-inbound-queue)
    - [5.1.4. Batch Processor](./5-components.md#514-batch-processor)
    - [5.1.5. Redis MS4 Outbound Queue](./5-components.md#515-redis-ms4-outbound-queue)
    - [5.1.6. MS4 Batch Sender](./5-components.md#516-ms4-batch-sender)
    - [5.1.7. Control API](./5-components.md#517-control-api)
    - [5.2. Component Diagrams](./5-components.md#52-component-diagrams)
  - [6. External APIs](./6-external-apis.md)
    - [6.1. Microsoft Graph API](./6-external-apis.md#61-microsoft-graph-api)
    - [6.2. MS4 Persistence API](./6-external-apis.md#62-ms4-persistence-api)
  - [7. Core Workflows](./7-core-workflows.md)
    - [7.1. Email Ingestion (Polling)](./7-core-workflows.md#71-email-ingestion-polling)
    - [7.2. Email Ingestion (Webhook)](./7-core-workflows.md#72-email-ingestion-webhook)
    - [7.3. Email Processing and MS4 Batch Forwarding](./7-core-workflows.md#73-email-processing-and-ms4-batch-forwarding)
  - [8. REST API Spec](./8-rest-api-spec.md)
  - [9. Database Schema](./9-database-schema.md)
    - [9.1. EmailMessage Storage](./9-database-schema.md#91-emailmessage-storage)
    - [9.2. Redis Inbound Queue](./9-database-schema.md#92-redis-inbound-queue)
    - [9.3. Redis MS4 Outbound Queue](./9-database-schema.md#93-redis-ms4-outbound-queue)
    - [9.4. SessionState Storage](./9-database-schema.md#94-sessionstate-storage)
    - [9.5. WebhookSubscription Storage](./9-database-schema.md#95-webhooksubscription-storage)
    - [9.6. Rate Limiting Counters](./9-database-schema.md#96-rate-limiting-counters)
    - [9.7. Processed Email Tracking](./9-database-schema.md#97-processed-email-tracking)
    - [9.8. Data Lifecycle Management (TTL)](./9-database-schema.md#98-data-lifecycle-management-ttl)
  - [10. Source Tree](./10-source-tree.md)
  - [11. Infrastructure and Deployment](./11-infrastructure-and-deployment.md)
    - [11.1. Infrastructure as Code](./11-infrastructure-and-deployment.md#111-infrastructure-as-code)
    - [11.2. Deployment Strategy](./11-infrastructure-and-deployment.md#112-deployment-strategy)
    - [11.3. Environments](./11-infrastructure-and-deployment.md#113-environments)
    - [11.4. Environment Promotion Flow](./11-infrastructure-and-deployment.md#114-environment-promotion-flow)
    - [11.5. Rollback Strategy](./11-infrastructure-and-deployment.md#115-rollback-strategy)
  - [12. Error Handling Strategy](./12-error-handling-strategy.md)
    - [12.1. General Approach](./12-error-handling-strategy.md#121-general-approach)
    - [12.2. Logging Standards](./12-error-handling-strategy.md#122-logging-standards)
    - [12.3. Error Handling Patterns](./12-error-handling-strategy.md#123-error-handling-patterns)
      - [12.3.1. External API Errors](./12-error-handling-strategy.md#1231-external-api-errors)
      - [12.3.2. Business Logic Errors](./12-error-handling-strategy.md#1232-business-logic-errors)
      - [12.3.3. Data Consistency](./12-error-handling-strategy.md#1233-data-consistency)
  - [13. Coding Standards](./13-coding-standards.md)
    - [13.1. Core Standards](./13-coding-standards.md#131-core-standards)
    - [13.2. Naming Conventions](./13-coding-standards.md#132-naming-conventions)
    - [13.3. Critical Rules](./13-coding-standards.md#133-critical-rules)
    - [13.4. Language-Specific Guidelines](./13-coding-standards.md#134-language-specific-guidelines)
      - [13.4.1. Python Specifics](./13-coding-standards.md#1341-python-specifics)
  - [14. Test Strategy and Standards](./14-test-strategy-and-standards.md)
    - [14.1. Testing Philosophy](./14-test-strategy-and-standards.md#141-testing-philosophy)
    - [14.2. Test Types and Organization](./14-test-strategy-and-standards.md#142-test-types-and-organization)
      - [14.2.1. Unit Tests](./14-test-strategy-and-standards.md#1421-unit-tests)
      - [14.2.2. Integration Tests](./14-test-strategy-and-standards.md#1422-integration-tests)
      - [14.2.3. End-to-End Tests](./14-test-strategy-and-standards.md#1423-end-to-end-tests)
    - [14.3. Test Data Management](./14-test-strategy-and-standards.md#143-test-data-management)
    - [14.4. Continuous Testing](./14-test-strategy-and-standards.md#144-continuous-testing)
  - [15. Security](./15-security.md)
    - [15.1. Input Validation](./15-security.md#151-input-validation)
    - [15.2. Authentication & Authorization](./15-security.md#152-authentication-authorization)
    - [15.3. Secrets Management](./15-security.md#153-secrets-management)
    - [15.4. API Security](./15-security.md#154-api-security)
    - [15.5. Data Protection](./15-security.md#155-data-protection)
    - [15.6. Dependency Security](./15-security.md#156-dependency-security)
    - [15.7. Security Testing](./15-security.md#157-security-testing)
